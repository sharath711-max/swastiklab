2026-02-09 06:17:03 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:03 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:03 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:03 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:03 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:03 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:03 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:03 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:03 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:03 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:03 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   phone TEXT,
2026-02-09 06:17:03 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   notes TEXT,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:03 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:03 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:03 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   media_path TEXT,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:03 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   reason TEXT,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üìä INDEXES
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:03 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:17:03 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:03 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:03 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:03 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:03 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:03 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:03 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:03 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:03 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:03 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:03 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   phone TEXT,
2026-02-09 06:17:03 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   notes TEXT,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:03 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:03 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:03 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   media_path TEXT,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:03 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   reason TEXT,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üìä INDEXES
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:03 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:17:03 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:03 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:03 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:03 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:03 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:03 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:03 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:03 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:03 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:03 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:03 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   phone TEXT,
2026-02-09 06:17:03 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   notes TEXT,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:03 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00: 
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:03 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:03 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:03 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   name TEXT,
2026-02-09 06:17:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   gross_weight REAL,
2026-02-09 06:17:03 +00:00:   purity REAL,
2026-02-09 06:17:03 +00:00:   media_path TEXT,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   deletedon DATETIME,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:03 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:03 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:03 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:03 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:03 +00:00:   reason TEXT,
2026-02-09 06:17:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:03 +00:00: );
2026-02-09 06:17:03 +00:00: -- üìä INDEXES
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:03 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:03 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:17:03 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:04 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:04 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:04 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:04 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:04 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:04 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:04 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   phone TEXT,
2026-02-09 06:17:04 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   notes TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:04 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   media_path TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   reason TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìä INDEXES
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:04 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:17:04 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:04 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:04 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:04 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:04 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:04 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:04 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:04 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   phone TEXT,
2026-02-09 06:17:04 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   notes TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:04 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   media_path TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   reason TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìä INDEXES
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:04 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:17:04 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:04 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:04 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:04 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:04 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:04 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:04 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:04 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   phone TEXT,
2026-02-09 06:17:04 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   notes TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:04 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   media_path TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   reason TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìä INDEXES
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:04 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:17:04 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:04 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:04 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:04 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:04 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:04 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:04 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:04 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:04 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   phone TEXT,
2026-02-09 06:17:04 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   notes TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:04 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:04 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00: 
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:04 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   name TEXT,
2026-02-09 06:17:04 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   gross_weight REAL,
2026-02-09 06:17:04 +00:00:   purity REAL,
2026-02-09 06:17:04 +00:00:   media_path TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   deletedon DATETIME,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:04 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:04 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:04 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:04 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:04 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:04 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:04 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:04 +00:00:   reason TEXT,
2026-02-09 06:17:04 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:04 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:04 +00:00: );
2026-02-09 06:17:04 +00:00: -- üìä INDEXES
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:04 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:04 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:17:05 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:05 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:05 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:05 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:05 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:05 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:05 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:05 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:05 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:05 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:05 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   phone TEXT,
2026-02-09 06:17:05 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   notes TEXT,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:05 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:05 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:05 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:05 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   media_path TEXT,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:05 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   reason TEXT,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üìä INDEXES
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:05 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:17:05 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:05 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:05 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:05 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:05 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:05 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:05 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:05 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:05 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:05 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:05 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   phone TEXT,
2026-02-09 06:17:05 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   notes TEXT,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:05 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:05 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:05 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:05 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   media_path TEXT,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:05 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   reason TEXT,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üìä INDEXES
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:05 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:17:05 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:17:05 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:17:05 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:17:05 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:17:05 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:05 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:17:05 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:17:05 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:17:05 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   password TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:17:05 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   value TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:17:05 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üë• CUSTOMER
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   name TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   phone TEXT,
2026-02-09 06:17:05 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   notes TEXT,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:17:05 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:17:05 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:17:05 +00:00:   gst_bill_number TEXT,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00: 
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:17:05 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:17:05 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:17:05 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   name TEXT,
2026-02-09 06:17:05 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   gross_weight REAL,
2026-02-09 06:17:05 +00:00:   purity REAL,
2026-02-09 06:17:05 +00:00:   media_path TEXT,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   deletedon DATETIME,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:17:05 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:17:05 +00:00:   mode_of_payment TEXT,
2026-02-09 06:17:05 +00:00:   description TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:17:05 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:17:05 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:17:05 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:17:05 +00:00:   amount REAL NOT NULL,
2026-02-09 06:17:05 +00:00:   reason TEXT,
2026-02-09 06:17:05 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:17:05 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:17:05 +00:00: );
2026-02-09 06:17:05 +00:00: -- üìä INDEXES
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:17:05 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:17:05 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:00 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:00 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:00 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:00 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:00 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:00 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:00 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:00 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:00 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:00 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:00 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:00 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:00 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:00 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:00 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:00 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:00 +00:00:   deletedon DATETIME
2026-02-09 06:18:00 +00:00: );
2026-02-09 06:18:00 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:00 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:00 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:00 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:00 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:00 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:00 +00:00: );
2026-02-09 06:18:00 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:00 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:00 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:00 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:00 +00:00: );
2026-02-09 06:18:00 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:00 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:00 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:00 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:00 +00:00:   phone TEXT,
2026-02-09 06:18:00 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:00 +00:00:   notes TEXT,
2026-02-09 06:18:00 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:00 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:00 +00:00:   deletedon DATETIME
2026-02-09 06:18:00 +00:00: );
2026-02-09 06:18:00 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:00 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:00 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:00 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:00 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:00 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:00 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:00 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:00 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:00 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:00 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:00 +00:00:   deletedon DATETIME,
2026-02-09 06:18:00 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:00 +00:00: );
2026-02-09 06:18:00 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:00 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:00 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:00 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:00 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:00 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:00 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:00 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:00 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:00 +00:00:   deletedon DATETIME,
2026-02-09 06:18:00 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:00 +00:00: );
2026-02-09 06:18:00 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:00 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:00 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:00 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   media_path TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   reason TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìä INDEXES
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:01 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:01 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:01 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:01 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:01 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:01 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:01 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:01 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:01 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:01 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:01 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:01 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   phone TEXT,
2026-02-09 06:18:01 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   notes TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:01 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   media_path TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   reason TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìä INDEXES
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:01 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:01 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:01 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:01 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:01 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:01 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:01 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:01 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:01 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:01 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:01 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:01 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   phone TEXT,
2026-02-09 06:18:01 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   notes TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:01 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   media_path TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   reason TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìä INDEXES
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:01 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:01 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:01 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:01 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:01 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:01 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:01 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:01 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:01 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:01 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:01 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:01 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   phone TEXT,
2026-02-09 06:18:01 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   notes TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:01 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:01 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00: 
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:01 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   name TEXT,
2026-02-09 06:18:01 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   gross_weight REAL,
2026-02-09 06:18:01 +00:00:   purity REAL,
2026-02-09 06:18:01 +00:00:   media_path TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   deletedon DATETIME,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:01 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:01 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:01 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:01 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:01 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:01 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:01 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:01 +00:00:   reason TEXT,
2026-02-09 06:18:01 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:01 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:01 +00:00: );
2026-02-09 06:18:01 +00:00: -- üìä INDEXES
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:01 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:01 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:02 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:02 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:02 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:02 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   phone TEXT,
2026-02-09 06:18:02 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   notes TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:02 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   media_path TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   reason TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìä INDEXES
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:02 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:02 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:02 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:02 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:02 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   phone TEXT,
2026-02-09 06:18:02 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   notes TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:02 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   media_path TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   reason TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìä INDEXES
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:02 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:02 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:02 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:02 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:02 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   phone TEXT,
2026-02-09 06:18:02 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   notes TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:02 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   media_path TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   reason TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìä INDEXES
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:02 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:02 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:02 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:02 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:02 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   phone TEXT,
2026-02-09 06:18:02 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   notes TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:02 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   media_path TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   reason TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìä INDEXES
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:02 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:02 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:02 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:02 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:02 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:02 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:02 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   phone TEXT,
2026-02-09 06:18:02 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   notes TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:02 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:02 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00: 
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:02 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   name TEXT,
2026-02-09 06:18:02 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   gross_weight REAL,
2026-02-09 06:18:02 +00:00:   purity REAL,
2026-02-09 06:18:02 +00:00:   media_path TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   deletedon DATETIME,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:02 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:02 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:02 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:02 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:02 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:02 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:02 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:02 +00:00:   reason TEXT,
2026-02-09 06:18:02 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:02 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:02 +00:00: );
2026-02-09 06:18:02 +00:00: -- üìä INDEXES
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:02 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:02 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:18:03 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:18:03 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:18:03 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:18:03 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:18:03 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:03 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:18:03 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:18:03 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:18:03 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   password TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:18:03 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   value TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:18:03 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: -- üë• CUSTOMER
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   name TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   phone TEXT,
2026-02-09 06:18:03 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   notes TEXT,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:18:03 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   name TEXT,
2026-02-09 06:18:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   purity REAL,
2026-02-09 06:18:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   name TEXT,
2026-02-09 06:18:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   purity REAL,
2026-02-09 06:18:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:18:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:18:03 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:18:03 +00:00:   gst_bill_number TEXT,
2026-02-09 06:18:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   name TEXT,
2026-02-09 06:18:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   purity REAL,
2026-02-09 06:18:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00: 
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:18:03 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   name TEXT,
2026-02-09 06:18:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   purity REAL,
2026-02-09 06:18:03 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:18:03 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:18:03 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   name TEXT,
2026-02-09 06:18:03 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   gross_weight REAL,
2026-02-09 06:18:03 +00:00:   purity REAL,
2026-02-09 06:18:03 +00:00:   media_path TEXT,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   deletedon DATETIME,
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:18:03 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:18:03 +00:00:   mode_of_payment TEXT,
2026-02-09 06:18:03 +00:00:   description TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:18:03 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:18:03 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:18:03 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:18:03 +00:00:   amount REAL NOT NULL,
2026-02-09 06:18:03 +00:00:   reason TEXT,
2026-02-09 06:18:03 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:18:03 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:18:03 +00:00: );
2026-02-09 06:18:03 +00:00: -- üìä INDEXES
2026-02-09 06:18:03 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:18:03 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:18:03 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:18:03 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:18:03 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:18:03 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:18:03 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:18:03 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:32 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:32 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:32 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:32 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:32 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:32 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:32 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:32 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:32 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:32 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:32 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   phone TEXT,
2026-02-09 06:20:32 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   notes TEXT,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:32 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:32 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:32 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:32 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:32 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   name TEXT,
2026-02-09 06:20:32 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   purity REAL,
2026-02-09 06:20:32 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   name TEXT,
2026-02-09 06:20:32 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   purity REAL,
2026-02-09 06:20:32 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:32 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:32 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:32 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:32 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:32 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:32 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:32 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   name TEXT,
2026-02-09 06:20:32 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   purity REAL,
2026-02-09 06:20:32 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00: 
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:32 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   name TEXT,
2026-02-09 06:20:32 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   purity REAL,
2026-02-09 06:20:32 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:32 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:32 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   name TEXT,
2026-02-09 06:20:32 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   gross_weight REAL,
2026-02-09 06:20:32 +00:00:   purity REAL,
2026-02-09 06:20:32 +00:00:   media_path TEXT,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   deletedon DATETIME,
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:32 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:32 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:32 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:32 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:32 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:32 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:32 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:32 +00:00:   reason TEXT,
2026-02-09 06:20:32 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:32 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:32 +00:00: );
2026-02-09 06:20:32 +00:00: -- üìä INDEXES
2026-02-09 06:20:32 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:32 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:32 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:32 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:32 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:32 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:32 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:32 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:33 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:33 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:33 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:33 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:33 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:33 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:33 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:33 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   phone TEXT,
2026-02-09 06:20:33 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   notes TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:33 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   media_path TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   reason TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìä INDEXES
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:33 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:33 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:33 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:33 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:33 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:33 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:33 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:33 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:33 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   phone TEXT,
2026-02-09 06:20:33 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   notes TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:33 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   media_path TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   reason TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìä INDEXES
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:33 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:33 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:33 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:33 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:33 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:33 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:33 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:33 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:33 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   phone TEXT,
2026-02-09 06:20:33 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   notes TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:33 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   media_path TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   reason TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìä INDEXES
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:33 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:33 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:33 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:33 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:33 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:33 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:33 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:33 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:33 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:33 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   phone TEXT,
2026-02-09 06:20:33 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   notes TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:33 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:33 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00: 
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:33 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   name TEXT,
2026-02-09 06:20:33 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   gross_weight REAL,
2026-02-09 06:20:33 +00:00:   purity REAL,
2026-02-09 06:20:33 +00:00:   media_path TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   deletedon DATETIME,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:33 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:33 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:33 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:33 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:33 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:33 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:33 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:33 +00:00:   reason TEXT,
2026-02-09 06:20:33 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:33 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:33 +00:00: );
2026-02-09 06:20:33 +00:00: -- üìä INDEXES
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:33 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:33 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:34 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:34 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:34 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:34 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:34 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:34 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:34 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:34 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   phone TEXT,
2026-02-09 06:20:34 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   notes TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:34 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   media_path TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   reason TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìä INDEXES
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:34 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:34 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:34 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:34 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:34 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:34 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:34 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:34 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:34 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   phone TEXT,
2026-02-09 06:20:34 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   notes TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:34 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   media_path TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   reason TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìä INDEXES
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:34 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:34 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:34 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:34 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:34 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:34 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:34 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:34 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:34 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   phone TEXT,
2026-02-09 06:20:34 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   notes TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:34 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   media_path TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   reason TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìä INDEXES
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:34 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:34 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:34 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:34 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:34 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:34 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:34 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:34 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:34 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:34 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   phone TEXT,
2026-02-09 06:20:34 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   notes TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:34 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:34 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00: 
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:34 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   name TEXT,
2026-02-09 06:20:34 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   gross_weight REAL,
2026-02-09 06:20:34 +00:00:   purity REAL,
2026-02-09 06:20:34 +00:00:   media_path TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   deletedon DATETIME,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:34 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:34 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:34 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:34 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:34 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:34 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:34 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:34 +00:00:   reason TEXT,
2026-02-09 06:20:34 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:34 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:34 +00:00: );
2026-02-09 06:20:34 +00:00: -- üìä INDEXES
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:34 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:34 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:35 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:35 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:35 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:35 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:35 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:35 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:35 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:35 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:35 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:35 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:35 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   phone TEXT,
2026-02-09 06:20:35 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   notes TEXT,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:35 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:35 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:35 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:35 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:35 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   name TEXT,
2026-02-09 06:20:35 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   purity REAL,
2026-02-09 06:20:35 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   name TEXT,
2026-02-09 06:20:35 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   purity REAL,
2026-02-09 06:20:35 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:35 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:35 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:35 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:35 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:35 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:35 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:35 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   name TEXT,
2026-02-09 06:20:35 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   purity REAL,
2026-02-09 06:20:35 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00: 
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:35 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   name TEXT,
2026-02-09 06:20:35 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   purity REAL,
2026-02-09 06:20:35 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:35 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:35 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   name TEXT,
2026-02-09 06:20:35 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   gross_weight REAL,
2026-02-09 06:20:35 +00:00:   purity REAL,
2026-02-09 06:20:35 +00:00:   media_path TEXT,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   deletedon DATETIME,
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:35 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:35 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:35 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:35 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:35 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:35 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:35 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:35 +00:00:   reason TEXT,
2026-02-09 06:20:35 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:35 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:35 +00:00: );
2026-02-09 06:20:35 +00:00: -- üìä INDEXES
2026-02-09 06:20:35 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:35 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:35 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:35 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:35 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:35 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:35 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:35 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:44 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:20:44 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:20:44 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:20:44 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:20:44 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:44 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:20:44 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:20:44 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:20:44 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   password TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:20:44 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   value TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:20:44 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: -- üë• CUSTOMER
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   name TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   phone TEXT,
2026-02-09 06:20:44 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   notes TEXT,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:20:44 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:44 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:44 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:44 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:44 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   name TEXT,
2026-02-09 06:20:44 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   purity REAL,
2026-02-09 06:20:44 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   name TEXT,
2026-02-09 06:20:44 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   purity REAL,
2026-02-09 06:20:44 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:20:44 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:44 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:44 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:44 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:20:44 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:20:44 +00:00:   gst_bill_number TEXT,
2026-02-09 06:20:44 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   name TEXT,
2026-02-09 06:20:44 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   purity REAL,
2026-02-09 06:20:44 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00: 
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:20:44 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   name TEXT,
2026-02-09 06:20:44 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   purity REAL,
2026-02-09 06:20:44 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:20:44 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:20:44 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   name TEXT,
2026-02-09 06:20:44 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   gross_weight REAL,
2026-02-09 06:20:44 +00:00:   purity REAL,
2026-02-09 06:20:44 +00:00:   media_path TEXT,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   deletedon DATETIME,
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:20:44 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:20:44 +00:00:   mode_of_payment TEXT,
2026-02-09 06:20:44 +00:00:   description TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:20:44 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:20:44 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:20:44 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:20:44 +00:00:   amount REAL NOT NULL,
2026-02-09 06:20:44 +00:00:   reason TEXT,
2026-02-09 06:20:44 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:20:44 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:20:44 +00:00: );
2026-02-09 06:20:44 +00:00: -- üìä INDEXES
2026-02-09 06:20:44 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:20:44 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:20:44 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:20:44 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:20:44 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:20:44 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:20:44 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:20:44 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:20:44 +00:00: [2026-02-09T06:20:44.693Z] [INFO] üöÄ Server running on port 5000
2026-02-09 06:20:44 +00:00: üöÄ Server running on port 5000
2026-02-09 06:21:10 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:21:10 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:21:10 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:21:10 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:21:10 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:21:10 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:21:10 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:21:10 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:21:10 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   password TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:21:10 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   value TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:21:10 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: -- üë• CUSTOMER
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   name TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   phone TEXT,
2026-02-09 06:21:10 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   notes TEXT,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:21:10 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:10 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:10 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:10 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:10 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   name TEXT,
2026-02-09 06:21:10 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   purity REAL,
2026-02-09 06:21:10 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   name TEXT,
2026-02-09 06:21:10 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   purity REAL,
2026-02-09 06:21:10 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:21:10 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   gst_bill_number TEXT,
2026-02-09 06:21:10 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:21:10 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   gst_bill_number TEXT,
2026-02-09 06:21:10 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:21:10 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:21:10 +00:00:   gst_bill_number TEXT,
2026-02-09 06:21:10 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   name TEXT,
2026-02-09 06:21:10 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   purity REAL,
2026-02-09 06:21:10 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00: 
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:21:10 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   name TEXT,
2026-02-09 06:21:10 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   purity REAL,
2026-02-09 06:21:10 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:21:10 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:10 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   name TEXT,
2026-02-09 06:21:10 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   gross_weight REAL,
2026-02-09 06:21:10 +00:00:   purity REAL,
2026-02-09 06:21:10 +00:00:   media_path TEXT,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   deletedon DATETIME,
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:21:10 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   amount REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:21:10 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:10 +00:00:   description TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:21:10 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:21:10 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:10 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:10 +00:00:   amount REAL NOT NULL,
2026-02-09 06:21:10 +00:00:   reason TEXT,
2026-02-09 06:21:10 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:10 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:10 +00:00: );
2026-02-09 06:21:10 +00:00: -- üìä INDEXES
2026-02-09 06:21:10 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:21:10 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:21:10 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:21:10 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:21:10 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:21:10 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:21:10 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:21:10 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:21:10 +00:00: [2026-02-09T06:21:10.776Z] [INFO] üöÄ Server running on port 5000
2026-02-09 06:21:10 +00:00: üöÄ Server running on port 5000
2026-02-09 06:21:12 +00:00: PRAGMA journal_mode = WAL
2026-02-09 06:21:12 +00:00: PRAGMA journal_mode = WAL;
2026-02-09 06:21:12 +00:00: PRAGMA foreign_keys = ON;
2026-02-09 06:21:12 +00:00: PRAGMA synchronous = NORMAL;
2026-02-09 06:21:12 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:21:12 +00:00: -- üë§ USERS (Single login)
2026-02-09 06:21:12 +00:00: DROP TABLE IF EXISTS photo_certificate_item;
2026-02-09 06:21:12 +00:00: DROP TABLE IF EXISTS photo_certificate;
2026-02-09 06:21:12 +00:00: DROP TABLE IF EXISTS users;
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS users (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   username TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   password TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   role TEXT NOT NULL DEFAULT 'user', -- 'admin' or 'user'
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: -- üåê GLOBALS (Auto-number, sequences, config)
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS globals (
2026-02-09 06:21:12 +00:00:   key TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   value TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   lastmodified DATETIME NOT NULL
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: -- üî¢ SEQUENCES (For simple sequential IDs)
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS sequences (
2026-02-09 06:21:12 +00:00:   name TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   value INTEGER DEFAULT 0
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: -- üë• CUSTOMER
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS customer (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   name TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   phone TEXT,
2026-02-09 06:21:12 +00:00:   balance REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   notes TEXT,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: CREATE INDEX IF NOT EXISTS idx_customer_phone ON customer(phone);
2026-02-09 06:21:12 +00:00: -- üß™ TESTS (PARENT)
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS gold_test (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:12 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:12 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS silver_test (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:12 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:12 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: -- üß™ TEST ITEMS (CHILD)
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS gold_test_item (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   gold_test_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   name TEXT,
2026-02-09 06:21:12 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   purity REAL,
2026-02-09 06:21:12 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (gold_test_id) REFERENCES gold_test(id) ON DELETE CASCADE
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS silver_test_item (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   silver_test_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   name TEXT,
2026-02-09 06:21:12 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   sample_weight REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   purity REAL,
2026-02-09 06:21:12 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (silver_test_id) REFERENCES silver_test(id) ON DELETE CASCADE
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: -- üìú CERTIFICATES (PARENT ‚Äî FINANCIAL OWNER)
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   gst INTEGER DEFAULT 0,              -- 0 / 1
2026-02-09 06:21:12 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   gst_bill_number TEXT,
2026-02-09 06:21:12 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:21:12 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   gst_bill_number TEXT,
2026-02-09 06:21:12 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   auto_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   status TEXT CHECK (status IN ('TODO','IN_PROGRESS','DONE')) NOT NULL,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   total REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   gst INTEGER DEFAULT 0,
2026-02-09 06:21:12 +00:00:   total_tax REAL DEFAULT 0,
2026-02-09 06:21:12 +00:00:   gst_bill_number TEXT,
2026-02-09 06:21:12 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   lastmodified DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: -- üìÑ CERTIFICATE ITEMS (CHILD)
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS gold_certificate_item (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   gold_certificate_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   certificate_number TEXT NOT NULL,   -- A01, A02 (PRINT ONLY)
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   name TEXT,
2026-02-09 06:21:12 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   purity REAL,
2026-02-09 06:21:12 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00: 
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (gold_certificate_id)
2026-02-09 06:21:12 +00:00:     REFERENCES gold_certificate(id) ON DELETE CASCADE
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS silver_certificate_item (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   silver_certificate_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   name TEXT,
2026-02-09 06:21:12 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   gross_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   test_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   net_weight REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   purity REAL,
2026-02-09 06:21:12 +00:00:   returned INTEGER DEFAULT 0,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (silver_certificate_id)
2026-02-09 06:21:12 +00:00:     REFERENCES silver_certificate(id) ON DELETE CASCADE
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS photo_certificate_item (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   item_number TEXT NOT NULL UNIQUE,
2026-02-09 06:21:12 +00:00:   photo_certificate_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   certificate_number TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   name TEXT,
2026-02-09 06:21:12 +00:00:   item_type TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   gross_weight REAL,
2026-02-09 06:21:12 +00:00:   purity REAL,
2026-02-09 06:21:12 +00:00:   media_path TEXT,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   deletedon DATETIME,
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (photo_certificate_id)
2026-02-09 06:21:12 +00:00:     REFERENCES photo_certificate(id) ON DELETE CASCADE
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: -- üí∞ CREDIT HISTORY (APPEND ONLY)
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS credit_history (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   amount REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   type TEXT CHECK (type IN ('CREDIT','DEBIT')) NOT NULL,
2026-02-09 06:21:12 +00:00:   mode_of_payment TEXT,
2026-02-09 06:21:12 +00:00:   description TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: -- ‚öñÔ∏è WEIGHT LOSS HISTORY (APPEND ONLY)
2026-02-09 06:21:12 +00:00: CREATE TABLE IF NOT EXISTS weight_loss_history (
2026-02-09 06:21:12 +00:00:   id TEXT PRIMARY KEY,
2026-02-09 06:21:12 +00:00:   customer_id TEXT NOT NULL,
2026-02-09 06:21:12 +00:00:   amount REAL NOT NULL,
2026-02-09 06:21:12 +00:00:   reason TEXT,
2026-02-09 06:21:12 +00:00:   created DATETIME NOT NULL,
2026-02-09 06:21:12 +00:00:   FOREIGN KEY (customer_id) REFERENCES customer(id)
2026-02-09 06:21:12 +00:00: );
2026-02-09 06:21:12 +00:00: -- üìä INDEXES
2026-02-09 06:21:12 +00:00: CREATE INDEX IF NOT EXISTS idx_gt_status ON gold_test(status, deletedon);
2026-02-09 06:21:12 +00:00: CREATE INDEX IF NOT EXISTS idx_st_status ON silver_test(status, deletedon);
2026-02-09 06:21:12 +00:00: CREATE INDEX IF NOT EXISTS idx_gc_status ON gold_certificate(status, deletedon);
2026-02-09 06:21:12 +00:00: CREATE INDEX IF NOT EXISTS idx_sc_status ON silver_certificate(status, deletedon);
2026-02-09 06:21:12 +00:00: CREATE INDEX IF NOT EXISTS idx_pc_status ON photo_certificate(status, deletedon);
2026-02-09 06:21:12 +00:00: CREATE INDEX IF NOT EXISTS idx_ch_customer ON credit_history(customer_id);
2026-02-09 06:21:12 +00:00: CREATE INDEX IF NOT EXISTS idx_wlh_customer ON weight_loss_history(customer_id);
2026-02-09 06:21:12 +00:00: ‚úÖ Database initialized successfully
2026-02-09 06:21:12 +00:00: [2026-02-09T06:21:12.527Z] [INFO] üöÄ Server running on port 5000
2026-02-09 06:21:12 +00:00: üöÄ Server running on port 5000
